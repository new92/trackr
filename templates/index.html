<!--
Author: @new92
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <link rel="stylesheet" href="static/style.css" />
    <link rel="icon" href="https://www.thessmetro.gr/wp-content/uploads/2024/11/Thessmetro-Logo-Favicon.png" />
</head>
<body>
    <div class="language-selector">
        <label for="lang">Language:</label>
        <select id="lang" onchange="changeLanguage()">
            <option value="el" {% if language == 'el' %}selected{% endif %}>Ελληνικά</option>
            <option value="en" {% if language == 'en' %}selected{% endif %}>English</option>
            <option value="fr" {% if language == 'fr' %}selected{% endif %}>Français</option>
            <option value="de" {% if language == 'de' %}selected{% endif %}>Deutsch</option>
            <option value="es" {% if language == 'es' %}selected{% endif %}>Spanish</option>
        </select>
    </div>
    <center>
    <!-- <p>{{ data }}</p> -->
    <h1 class="page-title">ThessMetro Live Status</h1>
    <div class="status-bar {{ 'status-w' if data.working else 'status-nw' }}">
        {{ (data.operation + " 🟢") if data.working else (data.operation + " 🔴") }}
    </div>
    {% if data.announcement %}
        <div class="announcement-box">
            <h2 class="announcement-title">📢 {{ static.announcement }}</h2>
            <p>{{ data.announcement }}</p>
        </div>
    {% endif %}
    <div class="summary-box">
        🚇 {{ static.opst }}: <strong>{{ data.stationsWorking }}/{{ data.stations|length }}</strong><br>
        🛗 {{ static.opel }}: <strong>{{ data.elevatorsWorking }}/{{ data.elevators|length }}</strong>
    </div>
      <table>
        <thead>
            <tr>
                <th>{{ static.station }}🚇</th>
                <th>{{ static.operation }}</th>
            </tr>
        </thead>
        <tbody>
            {% for station in data.stations %}
                <tr class="{{ 'station-working' if station.working else 'station-not-working' }}">
                    <td>{{ station.name }}</td>
                    <td>{{ static.true if station.working else static.false }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <br /><br /><br /><br />
    <table>
        <thead>
            <tr>
                <th>{{ static.elevator }}🛗</th>
                <th>{{ static.operation }}</th>
            </tr>
        </thead>
        <tbody>
            {% for elev in data.elevators %}
                <tr class="{{ 'elevator-working' if elev.working else 'elevator-not-working' }}">
                    <td>{{ elev.station }}</td>
                    <td>{{ static.true if elev.working else static.false }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <div id="nearest-station" class="nearest-station-box">
        <span class="station-title">{{ static.nearest }}📍</span>
        <p id="nearest-info">{{ static.detect }}...</p>
    </div>
    <script>
        const normalop = "🟢 {{ static.operation }}";
        const oos = "🔴 {{ static.oos }}";
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                fetch("/api/nearest", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        lat: pos.coords.latitude,
                        lng: pos.coords.longitude,
                        lang: document.getElementById("lang").value
                    })
                })
                .then(res => res.json())
                .then(station => {
                    const box = document.getElementById("nearest-station");
                    const info = document.getElementById("nearest-info");
                    
                    if (station.working) {
                        box.classList.add("nearest-station-working");
                        info.textContent = `🚇 ${station.name} - ${normalop}`;
                    } else {
                        box.classList.add("nearest-station-not-working");
                        info.textContent = `🚇 ${station.name} - ${oos}`;
                    }
                });
            });
        } else {
            document.getElementById("nearest-info").innerText = "{{ static.error }}";
        }
    </script>
    <script>
        function changeLanguage() {
            const selectedLang = document.getElementById('lang').value;
            const url = new URL(window.location.href);
            url.searchParams.set('lang', selectedLang);
            window.location.href = url.toString();
        }
    </script>
</center></body>
</html>
